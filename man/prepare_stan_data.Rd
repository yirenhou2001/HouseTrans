% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data-preparation.R
\name{prepare_stan_data}
\alias{prepare_stan_data}
\title{Prepare Data for Stan Model}
\usage{
prepare_stan_data(
  df_clean,
  surveillance_df = NULL,
  role_levels = c("adult", "infant", "toddler", "elderly"),
  study_start_date = as.Date("2024-07-01"),
  study_end_date = as.Date("2025-07-01"),
  seasonal_forcing_list = NULL,
  use_vl_data = TRUE,
  covariates_susceptibility = NULL,
  covariates_infectivity = NULL,
  recovery_params = NULL,
  imputation_params = NULL,
  priors = list(),
  seed = 123
)
}
\arguments{
\item{df_clean}{Dataframe with observation data (must contain 'episode_id').}

\item{surveillance_df}{Dataframe with columns 'date' and 'cases'.}

\item{role_levels}{Character vector; canonical role levels.}

\item{study_start_date, study_end_date}{Date objects; study period.}

\item{seasonal_forcing_list}{Named list of forcing vectors.}

\item{use_vl_data}{Logical; whether to use viral load data.}

\item{covariates_susceptibility}{Character vector; susceptibility covariate names.}

\item{covariates_infectivity}{Character vector; infectivity covariate names.}

\item{recovery_params}{List of Gamma parameters (shape, scale) by role.}

\item{imputation_params}{List of viral curve parameters by role.}

\item{priors}{List of flexible priors (dist, params).}

\item{seed}{Integer; random seed.}
}
\value{
A list of data formatted for Stan.
}
\description{
Prepares household observation data for Stan model fitting, including
imputation of episode timing, covariate matrices, and viral load data.
}
\examples{
\dontrun{
household_profile <- list(
  prob_adults   = c(0, 0, 1),
  prob_infant   = 1.0,
  prob_siblings = c(0, .8, .2),
  prob_elderly  = c(0.7, 0.1, 0.2)
)

sim_res <- simulate_multiple_households_comm(
  n_households = 100,
  viral_testing = "viral load",
  infectious_shape = 10,
  infectious_scale = 1,
  waning_shape = 6,
  waning_scale = 10,
  surveillance_interval = 4,
  start_date = “2024-07-01”,
  end_date = “2025-06-30”,
  surveillance_df = surveillance_data,
  seed = 123,
  household_profile_list = household_profile
)
person_covariates <- sim_res$hh_df \%>\%
  dplyr::select(hh_id, person_id, vacc_status) \%>\%   dplyr::distinct()

df_for_stan <- sim_res$diagnostic_df \%>\%
  dplyr::left_join(person_covariates, by = c("hh_id", "person_id"))

stan_input <- prepare_stan_data(
  df_clean = df_for_stan,
  use_vl_data      = 1,
  study_start_date = as.Date(study_start),
  study_end_date   = as.Date(study_end),
  surveillance_df  = surveillance_data,
  study_start_date = as.Date(study_start),
  study_end_date   = as.Date(study_end),
  imputation_params = VL_params_list)
}
}
