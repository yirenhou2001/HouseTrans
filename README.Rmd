---
title: "README"
output: github_document
---
<!-- badges: start -->
[![R-CMD-check](https://github.com/yirenhou2001/Household.Transmission.Chain.Data.Analysis/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/yirenhou2001/Household.Transmission.Chain.Data.Analysis/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

# Household.Transmission.Chain.Data.Analysis

### Household transmission chain simulation, estimation, and visualization

This package provides a streamlined pipeline to simulate household infection dynamics, estimate transmission parameters, and visualize epidemic timelines. It uses a Bayesian approach with `rstan` that models transmission probability as a function of viral load, seasonality, and role-specific susceptibility/infectivity.

## Core Workflow

1. **`GenSyn()`**: Simulation and validation
   - Simulates household structures with viral load trajectories
   - Estimates parameters using Bayesian Stan
   - Validates results by comparing estimates against known ground truth

2. **`TransmissionChainAnalysis()`**: User data analysis
   - Estimates transmission parameters from your own observational data
   - Accepts either long-format testing data or per-person episode tables

## Quick Start

### 1) Simulate and estimate

```{r}
library(Household.Transmission.Chain.Data.Analysis)

# Define seasonal forcing (length must match max_days)
seasonal_forcing_list <- list(
  adult   = rep(0.1, 365),
  child   = rep(0.1, 365),
  elderly = rep(0.1, 365),
  toddler = rep(0.1, 365)
)

result <- GenSyn(
  n_households = 50,
  print_plots  = FALSE,
  seasonal_forcing_list = seasonal_forcing_list,
  max_days     = 365,
  
  # Stan sampling controls
  stan_chains  = 4,
  stan_iter    = 2000,
  stan_warmup  = 1000,
  stan_control = list(adapt_delta = 0.99, max_treedepth = 20),
  stan_cores   = 4
)

# View posterior summary
print(result$postprocessing)
```

### 2) Analyze your own data

```{r}
# Per-person episode format
T_max <- 30
df_person <- data.frame(
  hh_id             = c("HH1","HH1","HH1","HH2","HH2","HH2"),
  person_id         = c(1, 2, 3, 1, 2, 3),
  role              = c("adult","child","elderly","adult","child","elderly"),
  infection_time    = c(2, 4, NA, 1, 3, NA),
  infectious_start  = c(3, 6, NA, 2, 5, NA),
  infectious_end    = c(8, 9, NA, 7, 9, NA),
  infection_resolved= c(9, 10, NA, 8, 10, NA)
)

seasonal_forcing_list <- list(
  adult   = rep(1, T_max),
  child   = rep(1, T_max),
  elderly = rep(1, T_max),
  toddler = rep(1, T_max)
)

result <- TransmissionChainAnalysis(
  user_data             = df_person,
  seasonal_forcing_list = seasonal_forcing_list,
  max_days              = T_max,
  
  # Light Stan settings for quick testing
  stan_chains  = 1,
  stan_iter    = 500,
  stan_warmup  = 250,
  stan_control = list(adapt_delta = 0.98, max_treedepth = 12),
  stan_cores   = 1
)
```

## Input Data Formats

### Per-person episode table (recommended)

| Column             | Description                                    |
|--------------------|------------------------------------------------|
| `hh_id`            | Household identifier                           |
| `person_id`        | Individual ID within household                 |
| `role`             | Family role: "adult", "child", "toddler", "elderly" |
| `infection_time`   | Day of infection onset (NA if not infected)    |
| `infectious_start` | Day infectiousness begins                      |
| `infectious_end`   | Day infectiousness ends                        |
| `infection_resolved` | Day infection resolves                       |

### Long-format testing table

| Column             | Description                                    |
|--------------------|------------------------------------------------|
| `HH`               | Household identifier                           |
| `individual_ID`    | Individual ID within household                 |
| `role`             | Family role                                    |
| `test_date`        | Integer day or Date object                     |
| `infection_status` | Binary (0/1) indicating positive test          |

## Outputs

Both main functions return a result object containing:

* **`$results`**: Raw pipeline output including `fit` (Stan object) and `posterior_summary`

* **`$postprocessing`**: Clean summary table with posterior mean, SD, and 95% credible intervals for role-specific susceptibility (`phi`) and infectivity (`kappa`)

* **`$plot_list`**: Named list of `ggplot2` objects (when requested)

## Visualization

Built-in plotting capabilities are available via the `plots` argument:

* **`"daily"`**: Daily infections by role
* **`"weekly"`**: Weekly infections by role  
* **`"timeline"`**: Per-household infection and detection timelines
* **`"sar"`**: Secondary attack rate by index case viral load

```{r}
# Generate all plots
result <- GenSyn(
  n_households = 50,
  plots = c("daily", "weekly", "timeline", "sar"),
  print_plots = TRUE
)
```
